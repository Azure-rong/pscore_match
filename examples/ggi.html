

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Gerber-Green-Imai replication &mdash; pscore-match 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="top" title="pscore-match 0.0.1 documentation" href="../index.html" />
    <link rel="up" title="Examples" href="index.html" />
    <link rel="prev" title="Examples" href="index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="index.html" title="Examples"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pscore-match 0.0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Examples</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Gerber-Green-Imai replication</a><ul>
<li><a class="reference internal" href="#propensity-score-distributions">Propensity score distributions</a></li>
<li><a class="reference internal" href="#covariate-balance-tests">Covariate balance tests</a></li>
<li><a class="reference internal" href="#estimated-treatment-effects">Estimated treatment effects</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Examples</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/ggi.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="gerber-green-imai-replication">
<h1>Gerber-Green-Imai replication<a class="headerlink" href="#gerber-green-imai-replication" title="Permalink to this headline">¶</a></h1>
<p>Do get-out-the-vote initiatives increase voter turnout?
Gerber and Green (2000) set out to measure the effectiveness of different interventions: phone calls, mailers, door to door canvassing, and no intervention.
They found that in person canvassing substantially increased turnout, direct mail slightly increased it, and phone calls reduced it.
The finding was extreme: in single-voter households, they estimated that phone calls reduce turnout by <strong>27 percentage points</strong>.
This result called into question the millions of dollars and hours spent on telephone canvassing for elections.</p>
<p>Imai (2005) showed that the randomization in the field experiment did not go according to plan:
the randomization of the phone canvassing treatment was implemented incorrectly, resulting in selection bias.
Those who received phone calls with a message about how close the electoral race would be were 10 percentage points more likely to answer the phone than those who received phone calls with a message about civic duty.
Because of this, we can&#8217;t determine whether differences in voter turnout between the two groups is due to the different phone messages or due to characteristics of who answered the calls.</p>
<p>The dataset here only includes controls and people who received the phone treatment, AND actually answered the phone.
It does not include those who were called but did not answer,
and it does not include those who received mail or in-person treatment.</p>
<div class="section" id="propensity-score-distributions">
<h2>Propensity score distributions<a class="headerlink" href="#propensity-score-distributions" title="Permalink to this headline">¶</a></h2>
<p>Imai applied propensity score matching to correct for the covariate imbalances due to incomplete randomization in Gerber and Green&#8217;s experiment.
For the phone intervention, he matched 5 controls, with replacement, to each treated unit.
Imai ended up with 1,210 selected controls.
We find 858.
This difference could be due to small differences in the propensity score estimates.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pscore_match.data</span> <span class="kn">import</span> <span class="n">gerber_green_imai</span>
<span class="kn">from</span> <span class="nn">pscore_match.pscore</span> <span class="kn">import</span> <span class="n">PropensityScore</span>
<span class="kn">from</span> <span class="nn">pscore_match.match</span> <span class="kn">import</span> <span class="n">Match</span><span class="p">,</span> <span class="n">whichMatched</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">imai</span> <span class="o">=</span> <span class="n">gerber_green_imai</span><span class="p">()</span>

<span class="c1"># Create interaction terms</span>
<span class="n">imai</span><span class="p">[</span><span class="s1">&#39;PERSONS1_VOTE961&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">imai</span><span class="o">.</span><span class="n">PERSONS</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">imai</span><span class="o">.</span><span class="n">VOTE961</span>
<span class="n">imai</span><span class="p">[</span><span class="s1">&#39;PERSONS1_NEW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">imai</span><span class="o">.</span><span class="n">PERSONS</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">imai</span><span class="o">.</span><span class="n">NEW</span>
<span class="n">treatment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imai</span><span class="o">.</span><span class="n">PHNC1</span><span class="p">)</span>
<span class="n">cov_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PERSONS&#39;</span><span class="p">,</span> <span class="s1">&#39;VOTE961&#39;</span><span class="p">,</span> <span class="s1">&#39;NEW&#39;</span><span class="p">,</span> <span class="s1">&#39;MAJORPTY&#39;</span><span class="p">,</span> <span class="s1">&#39;AGE&#39;</span><span class="p">,</span> <span class="s1">&#39;WARD&#39;</span><span class="p">,</span> <span class="s1">&#39;AGE2&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;PERSONS1_VOTE961&#39;</span><span class="p">,</span> <span class="s1">&#39;PERSONS1_NEW&#39;</span><span class="p">]</span>
<span class="n">covariates</span> <span class="o">=</span> <span class="n">imai</span><span class="p">[</span><span class="n">cov_list</span><span class="p">]</span>
<span class="n">pscore</span> <span class="o">=</span> <span class="n">PropensityScore</span><span class="p">(</span><span class="n">treatment</span><span class="p">,</span> <span class="n">covariates</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="n">pairs</span> <span class="o">=</span> <span class="n">Match</span><span class="p">(</span><span class="n">treatment</span><span class="p">,</span> <span class="n">pscore</span><span class="p">)</span>
<span class="n">pairs</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;many-to-one&#39;</span><span class="p">,</span> <span class="n">many_method</span><span class="o">=</span><span class="s1">&#39;knn&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">data_matched</span> <span class="o">=</span> <span class="n">whichMatched</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;pscore&#39;</span><span class="p">:</span> <span class="n">pscore</span><span class="p">,</span> <span class="s1">&#39;treatment&#39;</span> <span class="p">:</span><span class="n">treatment</span><span class="p">,</span> <span class="s1">&#39;voted&#39;</span><span class="p">:</span><span class="n">imai</span><span class="o">.</span><span class="n">VOTED98</span><span class="p">}))</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../examples/ggi-1.py">Source code</a>)</p>
<p>Let&#8217;s see how the covariate imbalance improves after matching.
If there is good covariate balance, the treatment and control group distributions of propensity scores should overlap.
The gray smoothed density represents the treatment group and the black line represents controls.
Before matching, there are a large number of controls with smaller probability of getting called; after matching, we have a group of controls whose propensity scores match those in the treatment group.
Compare this to Figure 2 in Imai&#8217;s paper.</p>
<p>(<a class="reference external" href="../examples/ggi-2.py">Source code</a>, <a class="reference external" href="../examples/ggi-2.png">png</a>, <a class="reference external" href="../examples/ggi-2.hires.png">hires.png</a>, <a class="reference external" href="../examples/ggi-2.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/ggi-2.png" src="../_images/ggi-2.png" />
</div>
</div>
<div class="section" id="covariate-balance-tests">
<h2>Covariate balance tests<a class="headerlink" href="#covariate-balance-tests" title="Permalink to this headline">¶</a></h2>
<p>By definition, propensity score matching helps improve the overlap of the treatment and control group propensity score distributions.
But does our estimated propensity score help improve the overlap of <em>covariate</em> distributions?</p>
<p>We can check this visually, the same way as we did with the propensity score distributions before and after matching, or we can look at many covariates at once by running statistical tests.
For each covariate we want to balance, we can run a two-sample test to compare the distributions for the treatment and control groups.
We do this before matching and again after matching, instead comparing the treatment group with the matched controls.
We hope to see that the matched controls are similar to the treated group on all these covariates.</p>
<p><strong>Important note:</strong> I don&#8217;t &#8220;believe&#8221; the p-values coming out of these tests, in the sense that the necessary assumptions are definitely violated.
However, they can serve as a crude measure of how similar the treatment and control group distributions are.
A &#8220;small&#8221; p-value suggests that they&#8217;re very different.</p>
<p>Ideally, we&#8217;d want to iterate this process of estimating propensity scores and testing covariate balance until we deem them to be sufficiently balanced.
Here, I just used the propensity score model specification that Imai provided;
I assume he already tried to optimize for balance.</p>
<p>We ran both a t-test and a Wilcoxon rank sum test for each covariate in the propensity score model.
As we can see, covariate imbalance improved for everything except number of people in the household (PERSONS), which had decent balance to begin with.
The matching worked.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly</span>
<span class="n">pairs</span><span class="o">.</span><span class="n">plot_balance</span><span class="p">(</span><span class="n">covariates</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;ggi-balance&#39;</span><span class="p">,</span> <span class="n">auto_open</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../examples/ggi-3.py">Source code</a>)</p>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<div id="ce987fd6-161c-48c2-992f-669a6bea3711" style="height: 600px; width: 800px;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("ce987fd6-161c-48c2-992f-669a6bea3711", [{"mode": "markers", "y": ["PERSONS", "VOTE961", "NEW", "MAJORPTY", "AGE", "WARD", "AGE2", "PERSONS1_VOTE961", "PERSONS1_NEW"], "x": [0.6160613898757088, 1.4744304758384948e-08, 0.0006258661849617823, 0.04239676560187475, 2.0208034629229885e-13, 0.04354111952338745, 2.9278967120035454e-14, 0.06466713976234786, 0.09034557022787952], "marker": {"size": 12, "symbol": "circle", "color": "blue"}, "name": "t-test p-values before matching", "type": "scatter"}, {"mode": "markers", "y": ["PERSONS", "VOTE961", "NEW", "MAJORPTY", "AGE", "WARD", "AGE2", "PERSONS1_VOTE961", "PERSONS1_NEW"], "x": [0.5145023515449612, 0.5781725206665616, 0.5065584831587648, 0.9301484411237675, 0.8878753691892503, 0.8567440258501022, 0.9770833811897148, 0.17982774393549938, 0.5855409884169842], "marker": {"size": 12, "symbol": "circle", "color": "pink"}, "name": "t-test p-values after matching", "type": "scatter"}, {"mode": "markers", "y": ["PERSONS", "VOTE961", "NEW", "MAJORPTY", "AGE", "WARD", "AGE2", "PERSONS1_VOTE961", "PERSONS1_NEW"], "x": [0.6640834786648873, 1.006690361174639e-06, 0.017987852418741436, 0.12599391009268984, 4.365367805158009e-12, 0.04366855667008209, 4.365367805158009e-12, 0.1753618695299879, 0.33331123086950887], "marker": {"size": 12, "symbol": "triangle-up", "color": "blue"}, "name": "Wilcoxon test p-values before matching", "type": "scatter"}, {"mode": "markers", "y": ["PERSONS", "VOTE961", "NEW", "MAJORPTY", "AGE", "WARD", "AGE2", "PERSONS1_VOTE961", "PERSONS1_NEW"], "x": [0.5732983189097722, 0.6581167744483636, 0.7023339291292086, 0.9518825209263144, 0.9972710435718614, 0.7614421150725775, 0.9972710435718614, 0.3145525446114944, 0.7782500239608758], "marker": {"size": 12, "symbol": "triangle-up", "color": "pink"}, "name": "Wilcoxon test p-values after matching", "type": "scatter"}], {"width": 800, "hovermode": "closest", "height": 600, "shapes": [{"y0": -1, "x1": 0.05, "line": {"dash": "dot", "color": "gray"}, "x0": 0.05, "type": "line", "y1": 9}], "title": "Balance test p-values, before and after matching", "margin": {"b": 80, "l": 140, "r": 40, "t": 80}, "xaxis": {"tickfont": {"color": "gray"}, "showgrid": false, "tickmode": "array", "tickvals": [0, 0.05, 0.1, 0.5, 1], "ticktext": [0, 0.05, 0.1, 0.5, 1], "titlefont": {"color": "gray"}, "linecolor": "gray", "tickcolor": "gray", "showline": true, "ticks": "outside"}, "legend": {"orientation": "h", "font": {"size": 10}}}, {"linkText": "Export to plot.ly", "showLink": false})</script></div>
<div class="section" id="estimated-treatment-effects">
<h2>Estimated treatment effects<a class="headerlink" href="#estimated-treatment-effects" title="Permalink to this headline">¶</a></h2>
<p>Now, let&#8217;s compare the estimated average treatment effect on the treated (ATT) before and after matching.
We can&#8217;t compare directly with Gerber and Green or Imai, because we don&#8217;t have the data on noncompliers (those who didn&#8217;t answer the phone).
Their estimates account for the noncompliance rate.
However, our post-matching estimate (7.2%) is close to what Imai reports (6.5%).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">treated_turnout</span> <span class="o">=</span> <span class="n">imai</span><span class="o">.</span><span class="n">VOTED98</span><span class="p">[</span><span class="n">treatment</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">control_turnout</span> <span class="o">=</span> <span class="n">imai</span><span class="o">.</span><span class="n">VOTED98</span><span class="p">[</span><span class="n">treatment</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">matched_control_turnout</span> <span class="o">=</span> <span class="n">data_matched</span><span class="o">.</span><span class="n">voted</span><span class="p">[</span><span class="n">data_matched</span><span class="o">.</span><span class="n">treatment</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">ATT</span> <span class="o">=</span> <span class="n">treated_turnout</span> <span class="o">-</span> <span class="n">control_turnout</span>
<span class="n">matched_ATT</span> <span class="o">=</span> <span class="n">treated_turnout</span> <span class="o">-</span> <span class="n">matched_control_turnout</span>
<span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;ATT: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ATT</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;ATT after matching: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">matched_ATT</span><span class="p">)))</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../examples/ggi-4.py">Source code</a>)</p>
<p>ATT: 0.203528335107</p>
<p>ATT after matching: 0.0720647773279</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="index.html" title="Examples"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pscore-match 0.0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Examples</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, Kellie Ottoboni.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>